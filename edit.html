<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Hakem Kart Sistemi â€“ DÃ¼zenleme</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin:0; background:#f5f5f5; }
    .banner-container { overflow:hidden; background:#eee; white-space:nowrap; }
    .banner { display:inline-block; padding:10px; font-weight:bold; animation:scroll 20s linear infinite; }
    @keyframes scroll { from{transform: translateX(100%);} to{transform: translateX(-100%);} }
    .top-controls, .search-container { margin:10px auto; display:flex; justify-content:center; gap:6px; flex-wrap:wrap; }
    .top-controls input, .top-controls button, .search-container input { font-size:15px; padding:6px 10px; border:none; border-radius:12px; }
    .top-controls button { background:#777; color:white; }
    .person-section { border-top:1px solid #ccc; padding:6px; font-size:14px; position:relative; }
    .card { display:inline-block; width:45px; height:45px; line-height:45px; border-radius:50%; font-weight:bold; margin:2px; font-size:14px; }
    .gelb { background:#FFD700; color:black; } .rot { background:#E53935; color:white; } .gruen { background:#43A047; color:white; }
    .button { font-size:14px; padding:6px 12px; margin:2px; border:none; border-radius:12px; background:#888; color:white; }
    .trash { position:absolute; right:8px; top:8px; cursor:pointer; font-size:18px; }
    #overlay, #leaderboardModal { display:none; position:fixed; }
    #overlay { top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,0.3); z-index:999; }
    #leaderboardModal { top:10%; left:50%; transform:translateX(-50%); background:white; padding:10px; width:90%; max-width:400px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); z-index:1000; }
  </style>
</head>
<body>
  <div class="banner-container"><div class="banner" id="rankingBanner">YÃ¼kleniyor...</div></div>
  <div class="top-controls">
    <input id="newPlayerName" placeholder="Yeni Ä°sim" />
    <button onclick="addPlayer()">â• Ekle</button>
    <button onclick="resetCards()">ğŸ”„ SÄ±fÄ±rla</button>
    <button onclick="exportCSV()">CSV</button>
    <button onclick="undo()">âª Geri Al</button>
    <button onclick="showLeaderboard()">ğŸ† SÄ±ralama</button>
  </div>
  <div class="search-container">
    <input id="searchInput" placeholder="ğŸ” Oyuncu ara..." oninput="render()" />
  </div>
  <div id="personsContainer"></div>
  <div id="overlay" onclick="hideLeaderboard()"></div>
  <div id="leaderboardModal"><h3>ğŸ† Kart BazlÄ± SÄ±ralama</h3><div id="leaderboardContent"></div><button onclick="hideLeaderboard()">Kapat</button></div>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // === Firebase Setup: FÃ¼ge deine Config hier ein ===
    const firebaseConfig = {
      apiKey: "AIzaSyDdFkQi5D_4-zxVWCYxozq1XccBP9uoN6g",
      authDomain: "hakem-kart.firebaseapp.com",
      databaseURL: "https://hakem-kart-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "hakem-kart",
      storageBucket: "hakem-kart.firebasestorage.app",
      messagingSenderId: "941518144701",
      appId: "1:941518144701:web:072ed142fa0bd0d37963d4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let data = { persons: {} }, persons = [], lastAction = null;
    
    // Daten vom Cloud laden:
    db.ref('kartendaten').on('value', snap => {
      const d = snap.val();
      if (d) data = d;
      init();
    });

    function init(){
      if (!data.persons || Object.keys(data.persons).length === 0){
        data.persons = {"Hilal HanÄ±m":cz(),"Medine HanÄ±m":cz(),"Beyzanur HanÄ±m":cz(),"Mustafa Bey":cz()};
      }
      persons = Object.keys(data.persons);
      save(); render();
    }
    function cz(){return {gelb:0,rot:0,gruen:0,doener:0,totalGelb:0,totalRot:0,totalGruen:0,totalDoener:0};}

    function save(){
      db.ref('kartendaten').set(data);
    }

    function addPlayer(){
      const name = document.getElementById("newPlayerName").value.trim(); if(!name||data.persons[name])return;
      data.persons[name] = cz();
      persons.push(name); save(); render();
      document.getElementById("newPlayerName").value="";
    }
    function addCard(name, type){
      const p = data.persons[name];
      lastAction = { name, type };
      if(type==="gelb"){p.gelb++;p.totalGelb++;if(p.gelb>=3){p.gelb-=3;addCard(name,"rot");return;}}
      if(type==="rot"){p.rot++;p.totalRot++;if(p.rot>=6){p.rot=0;p.doener++;}}
      if(type==="gruen"){p.gruen++;p.totalGruen++;}
      save(); render();
    }
    function undo(){
      if(!lastAction)return;
      const {name,type}=lastAction; const p=data.persons[name];
      if(type==="gelb"&&p.gelb>0){p.gelb--;p.totalGelb--;}
      if(type==="rot"&&p.rot>0){p.rot--;p.totalRot--;}
      if(type==="gruen"&&p.gruen>0){p.gruen--;p.totalGruen--;}
      lastAction=null; save(); render();
    }
    function deletePlayer(name){
      if(confirm(`"${name}" silinsin mi?`)){delete data.persons[name]; persons = Object.keys(data.persons); save(); render();}
    }
    function doenerBezahlt(name){
      const p=data.persons[name];
      if(p.doener>0){p.doener--;p.totalDoener++;save();render();}
    }
    function resetCards(){
      if(confirm("Kartlar sÄ±fÄ±rlansÄ±n mÄ±?")){
        persons.forEach(n=>{const p=data.persons[n];p.gelb=0;p.rot=0;p.gruen=0;p.doener=0;});
        save(); render();
      }
    }
    function render(){
      const s=document.getElementById("searchInput").value.trim().toLowerCase(), c=document.getElementById("personsContainer");
      c.innerHTML=""; persons=Object.keys(data.persons);
      persons.forEach(n=>{
        if(s && !n.toLowerCase().includes(s))return;
        const p=data.persons[n];
        const div=document.createElement("div"); div.className="person-section";
        div.innerHTML = `
          <span class="trash" onclick="deletePlayer('${n}')">ğŸ—‘ï¸</span>
          <h3>${n}</h3>
          <div>
            <div class="card gelb">${p.gelb}</div>
            <div class="card rot">${p.rot}</div>
            <div class="card gruen">${p.gruen}</div>
            <div>ğŸ– DÃ¶ner: ${p.doener} | Ã–dedi: ${p.totalDoener}</div>
          </div>
          <button class="button" onclick="addCard('${n}','gelb')">SarÄ±</button>
          <button class="button" onclick="addCard('${n}','rot')">KÄ±rmÄ±zÄ±</button>
          <button class="button" onclick="addCard('${n}','gruen')">YeÅŸil</button>
          <button class="button" onclick="doenerBezahlt('${n}')">DÃ¶ner Ã¶dedi</button>
        `;
        c.appendChild(div);
      });
      updateBanner();
    }
    function updateBanner(){
      let totalS=0,totalR=0,totalY=0,topS=["",0],topR=["",0],topY=["",0];
      persons.forEach(n=>{
        const p=data.persons[n];
        totalS+=p.totalGelb; totalR+=p.totalRot; totalY+=p.totalGruen;
        if(p.totalGelb>topS[1])topS=[n,p.totalGelb];
        if(p.totalRot>topR[1])topR=[n,p.totalRot];
        if(p.totalGruen>topY[1])topY=[n,p.totalGruen];
      });
      document.getElementById("rankingBanner").innerText=
        `Top SarÄ±: ${topS[0]} (${topS[1]}) | KÄ±rmÄ±zÄ±: ${topR[0]} (${topR[1]}) | YeÅŸil: ${topY[0]} (${topY[1]})`;
    }
    function showLeaderboard(){
      let s=0,r=0,y=0,topS=["",0],topR=["",0],topY=["",0],topD=["",0];
      persons.forEach(n=>{
        const p=data.persons[n];
        s+=p.totalGelb; r+=p.totalRot; y+=p.totalGruen;
        if(p.totalGelb>topS[1])topS=[n,p.totalGelb];
        if(p.totalRot>topR[1])topR=[n,p.totalRot];
        if(p.totalGruen>topY[1])topY=[n,p.totalGruen];
        if(p.totalDoener>topD[1])topD=[n,p.totalDoener];
      });
      document.getElementById("leaderboardContent").innerHTML=`
        <div><strong>Top SarÄ±:</strong> ${topS[0]} (${topS[1]})</div>
        <div><strong>Top KÄ±rmÄ±zÄ±:</strong> ${topR[0]} (${topR[1]})</div>
        <div><strong>Top YeÅŸil:</strong> ${topY[0]} (${topY[1]})</div>
        <div><strong>Top DÃ¶ner Ã–dedi:</strong> ${topD[0]} (${topD[1]})</div><hr/>
        <div><strong>Toplam SarÄ±:</strong> ${s}</div>
        <div><strong>Toplam KÄ±rmÄ±zÄ±:</strong> ${r}</div>
        <div><strong>Toplam YeÅŸil:</strong> ${y}</div>`;
      document.getElementById("overlay").style.display="block";
      document.getElementById("leaderboardModal").style.display="block";
    }
    function hideLeaderboard(){
      document.getElementById("overlay").style.display="none";
      document.getElementById("leaderboardModal").style.display="none";
    }
    function exportCSV(){
      const rows=[["Ä°sim","SarÄ±","KÄ±rmÄ±zÄ±","YeÅŸil","DÃ¶ner","Toplam SarÄ±","Toplam KÄ±rmÄ±zÄ±","Toplam YeÅŸil","Toplam DÃ¶ner"]];
      persons.forEach(n=>{
        const p=data.persons[n];
        rows.push([n,p.gelb,p.rot,p.gruen,p.doener,p.totalGelb,p.totalRot,p.totalGruen,p.totalDoener]);
      });
      const csv=rows.map(r=>r.join(";")).join("\n");
      const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"}), url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url; a.download="kartlar.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    render();
  </script>
</body>
</html>
